在绘制二维图形的时候我们只需要考虑x、y坐标，但是在绘制三维图形的时候我们还需要考虑**深度信息**。

## 视点和视线

观察者所在的位置称之为视点，观察者从视点出发沿着观察方向的射线称之为视线。

1. 视点：观察者位置矢量。默认(0, 0, 0)
2. 观察目标点：观察目标位置矢量。默认(0, 0, -1)
3. 上方向：固定观察者，如果只确定视点和观察目标点观察者仍然可以沿着视线旋转，所以当上方向固定观察者也就固定了。默认(0, 1, 0)

使用上面三个矢量可以创建一个**视图矩阵**，所以可以通过设置视图矩阵来绘制从不同视点观察的图形。在webGL中也是通过视图矩阵来变换坐标点而达到的：

```
gl_Position = viewMatrix * a_Position;
```

所以：实际上，根据自定义观察者的状态，绘制观察者看到的景象，与使用默认观察者状态，但是对景象进行平移、缩放等变换后，再绘制观察者看到的景象是等价的。简单来说：**改变观察者状态与对整个世界进行变换效果是一样的。**

## 从视点位置查看变换后的图形

<旋转后的顶点坐标> = <旋转变换矩阵> * <原始坐标点>

<从视点看旋转后的顶点坐标> = <视图矩阵> * <旋转后的顶点坐标>


## 可视空间

只有在可视空间内的图形webGL才会绘制，这样复合人眼的直觉还能优化性能。水平视角、垂直视角、可视深度共同定义了**可视空间**。

- 长方体可视空间：正射投影产生
- 四棱锥、金字塔可视空间：透视投影产生

### 长方体可视空间，p234

使用**正射投影矩阵**可以表示长方体可视空间，canvas上显示的图形就是物体在可视空间中的近剪切面的投影，如果剪切面得比例与canvas比例不一样那么图形就会被按照canvas的比例进行压缩。

### 金字塔可视空间，p246，附录C投影矩阵

使用**透视投影矩阵**可以表示金字塔可视空间。

透视投影矩阵做了两件事：1. 根据三角形距离视点的距离对三角形进行了缩放变换，2. 对三角形进行平移变换

## 空间中图形的前后关系

webGL 在默认情况下会按照缓冲区中的数据顺序进行图形的绘制，**后绘制的图形会覆盖先绘制的图形**。webGL 提供了**隐藏面消除**的功能，被遮挡的物体不会被绘制出来。

```js
gl.enable(gl.DEPTH_TEST)

// 清除上一帧的深度缓冲区
gl.clear(gl.DEPTH_BUFFER_BIT)
```

webGL 使用**深度缓冲区**来存储图形的深度信息。在进行**每一次绘制之前都必须清除上一帧的深度缓冲区**，防止出现错误的结果。

gl.clear 方法可以一次清除多个缓冲区：

```js
gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT)
```
